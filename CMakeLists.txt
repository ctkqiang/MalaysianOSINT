cmake_minimum_required(VERSION 3.10)
project(MalaysianOsint C)

# ================================================================
# è®¾ç½® C æ ‡å‡†
# ================================================================
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)

# verbose é€‰é¡¹ï¼ˆmake æ„å»ºæ—¶æ˜¾ç¤ºå‘½ä»¤ï¼‰
set(CMAKE_VERBOSE_MAKEFILE OFF)

# ================================================================
# æ‰“å°å—çŠ¶ Logo
# ================================================================
message("\n")
message("â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—")
message("â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•")
message("â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   ")
message("â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   ")
message("â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   ")
message("â•šâ•â•     â•šâ•â•   â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   ")
message("\n")

# ================================================================
# åŒ…å«å¤´æ–‡ä»¶ç›®å½•
# ================================================================
include_directories(${CMAKE_SOURCE_DIR}/include)

# ================================================================
# æºç æ–‡ä»¶
# ================================================================
set(SOURCES
    src/pdrm.c
    src/sspi.c
    src/mykad.c
    src/rmp_wanted.c
    src/ecourt.c
    src/ssm.c
    my_osint.c
)

# ================================================================
# æŸ¥æ‰¾ä¾èµ–åº“
# ================================================================
find_package(PkgConfig REQUIRED)

# libcurl
pkg_check_modules(LIBCURL REQUIRED libcurl)
# libmicrohttpd
pkg_check_modules(MICROHTTPD REQUIRED libmicrohttpd)
# libcjson
pkg_check_modules(CJSON REQUIRED libcjson)

# æ·»åŠ åº“çš„å¤´æ–‡ä»¶ç›®å½•
include_directories(
    ${LIBCURL_INCLUDE_DIRS}
    ${MICROHTTPD_INCLUDE_DIRS}
    ${CJSON_INCLUDE_DIRS}
)

# æ·»åŠ åº“çš„é“¾æ¥ç›®å½•
link_directories(
    ${LIBCURL_LIBRARY_DIRS}
    ${MICROHTTPD_LIBRARY_DIRS}
    ${CJSON_LIBRARY_DIRS}
)

# ================================================================
# åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶
# ================================================================
add_executable(mo ${SOURCES})

# é“¾æ¥åº“
target_link_libraries(mo
    ${LIBCURL_LIBRARIES}
    ${MICROHTTPD_LIBRARIES}
    ${CJSON_LIBRARIES}
)

# ================================================================
# å®‰è£…è§„åˆ™
# ================================================================
install(TARGETS mo DESTINATION bin)
install(DIRECTORY include/ DESTINATION include)

# ================================================================
# æ„å»ºä¿¡æ¯è¾“å‡ºï¼ˆä¸­æ–‡ç®€æ´ç¾åŒ–ï¼‰
# ================================================================
if(LIBCURL_FOUND)
    set(LIBCURL_VER ${LIBCURL_VERSION})
else()
    set(LIBCURL_VER "æœªæ‰¾åˆ°")
endif()

if(MICROHTTPD_FOUND)
    set(MICROHTTPD_VER "å·²æ‰¾åˆ°")
else()
    set(MICROHTTPD_VER "æœªæ‰¾åˆ°")
endif()

if(CJSON_FOUND)
    set(CJSON_VER ${CJSON_VERSION})
else()
    set(CJSON_VER "æœªæ‰¾åˆ°")
endif()

message("\n================================================")
message("-- é¡¹ç›®ä¿¡æ¯")
message("-- é¡¹ç›®åç§°      : ${PROJECT_NAME}")
message("-- å¹³å°          : ${CMAKE_SYSTEM_NAME}")
message("-- æ¶æ„          : ${CMAKE_SYSTEM_PROCESSOR}")
message("-- æ„å»ºç±»å‹      : ${CMAKE_BUILD_TYPE}")
message("-- ç¼–è¯‘å™¨        : ${CMAKE_C_COMPILER_ID}")
message("-- C æ ‡å‡†        : C${CMAKE_C_STANDARD}")
message("-- å®‰è£…è·¯å¾„      : ${CMAKE_INSTALL_PREFIX}")
message("--")
message("-- ä¾èµ–åº“ä¿¡æ¯")
message("-- libcurl        : ${LIBCURL_VER}")
message("-- libmicrohttpd  : ${MICROHTTPD_VER}")
message("-- libcjson       : ${CJSON_VER}")
message("================================================\n")

# æ„å»ºæ¨¡å¼æç¤º
if(CMAKE_BUILD_TYPE MATCHES "Debug")
    message("ğŸ¼ å½“å‰æ¨¡å¼      : DEBUGï¼ˆè¯¦ç»†æ—¥å¿—å¼€å¯ï¼‰\n")
else()
    message("âœ¨ å½“å‰æ¨¡å¼      : ${CMAKE_BUILD_TYPE}\n")
endif()

# æˆåŠŸæç¤º
message("ğŸ‰ é…ç½®å®Œæˆï¼å¯ä»¥è¿è¡Œ `make run` æ„å»ºé¡¹ç›®\n")
message("================================================\n")
message("ç°åœ¨è¿è¡Œ make run æ¥æ‰§è¡Œåº”ç”¨ç¨‹åº\n")
